<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><link rel="stylesheet" href="/iconfont/iconfont.css"/><link rel="stylesheet" href="/css/valine.css"/><script src="//unpkg.com/valine/dist/Valine.min.js"></script><title>文章详情</title><meta name="next-head-count" content="6"/><link rel="preload" href="/_next/static/css/15b92494358f552df174.css" as="style"/><link rel="stylesheet" href="/_next/static/css/15b92494358f552df174.css"/><link rel="preload" href="/_next/static/css/052ae0a44094706a10c2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/052ae0a44094706a10c2.css"/><link rel="preload" href="/_next/static/css/f0082a2b33ba635f4dd9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f0082a2b33ba635f4dd9.css"/><link rel="preload" href="/_next/static/chunks/main-d5ecf0b3951669ce080c.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1b5fae6dde8a26be77ac.js" as="script"/><link rel="preload" href="/_next/static/chunks/346fcacd.acdc88755e55ded238c8.js" as="script"/><link rel="preload" href="/_next/static/chunks/5b942159a78d3c3cc608ccd4b77e51e0983cab29.ed4d58faabcf26e54f52.js" as="script"/><link rel="preload" href="/_next/static/chunks/08b74a7a597619e1b87151c58acc0528a78ab6f6.c061d003d0886c32baa8.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-176d4174c88ce65d60a8.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/front/%5Bid%5D-d60ad66e03ab4249afa4.js" as="script"/></head><body><div id="__next"><div class="Header_nav__p_kME"><a class="Header_item__3KWCo" href="/">博客首页</a><a class="Header_item__3KWCo" href="/front">文章列表</a><a class="Header_item__3KWCo" href="/front/logs">更新日志</a><a class="Header_item__3KWCo" href="/front/about">关于</a></div><div class="main"><div class="FrontRoute_container__zQhnm"><div class="FrontRoute_markdown__3G6E8"><h1>服务端仓库共享问题</h1><p>只要服务端不关闭,无论多少次请求,无论是否是同一个客户端的请求,仓库总是同一个,这样当然不行</p><p>使用函数创建仓库</p><pre><code class="language-js">function makeStore(){
  let store = null

  // 判断当前运行环境
  // 只有浏览器环境,才有 document
  if (global.document) {
    const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose
    store = createStore(
      reducer,
      window.state,
      composeEnhancers(applyMiddleware(thunk))
    )
  } else {
    store = createStore(
      reducer,
      applyMiddleware(thunk)
    )
  }

  return store
}

export default makeStore</code></pre></div><hr/><div><div class="FrontRoute_aside__3gFP5"><div class="FrontRouteAside_container__1pfKw"><a class="FrontRouteAside_link__4IF8A FrontRouteAside_left__1-G8B" href="/front/1">上一篇：getServerSideProps方法</a><a class="FrontRouteAside_link__4IF8A FrontRouteAside_right__286L6" href="/front/3">下一篇：服务端渲染组件 &amp; 客户端渲染组件</a></div></div><div class="FrontRoute_comments__2cMR7"><div><h2>发表评论</h2><div class="Comment_wrapper__184xV2"></div><h2 id="/front/2" class="leancloud_visitors" data-flag-title="服务端仓库共享问题"><i class="iconfont icon-liulan"></i>  <i class="leancloud-visitors-count"></i></h2></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"2","title":"服务端仓库共享问题","prev":{"id":1,"title":"getServerSideProps方法"},"next":{"id":3,"title":"服务端渲染组件 \u0026 客户端渲染组件"},"md":{"data":"# 服务端仓库共享问题\r\n只要服务端不关闭,无论多少次请求,无论是否是同一个客户端的请求,仓库总是同一个,这样当然不行\r\n\r\n使用函数创建仓库\r\n```js\r\nfunction makeStore(){\r\n  let store = null\r\n\r\n  // 判断当前运行环境\r\n  // 只有浏览器环境,才有 document\r\n  if (global.document) {\r\n    const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose\r\n    store = createStore(\r\n      reducer,\r\n      window.state,\r\n      composeEnhancers(applyMiddleware(thunk))\r\n    )\r\n  } else {\r\n    store = createStore(\r\n      reducer,\r\n      applyMiddleware(thunk)\r\n    )\r\n  }\r\n\r\n  return store\r\n}\r\n\r\nexport default makeStore\r\n```\r\n"}},"__N_SSG":true},"page":"/front/[id]","query":{"id":"2"},"buildId":"jB9Y7kPKJdexBq0JD9Xuy","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-c0664c850fd807bc92c2.js"></script><script src="/_next/static/chunks/main-d5ecf0b3951669ce080c.js" async=""></script><script src="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" async=""></script><script src="/_next/static/chunks/framework.1b5fae6dde8a26be77ac.js" async=""></script><script src="/_next/static/chunks/346fcacd.acdc88755e55ded238c8.js" async=""></script><script src="/_next/static/chunks/5b942159a78d3c3cc608ccd4b77e51e0983cab29.ed4d58faabcf26e54f52.js" async=""></script><script src="/_next/static/chunks/08b74a7a597619e1b87151c58acc0528a78ab6f6.c061d003d0886c32baa8.js" async=""></script><script src="/_next/static/chunks/pages/_app-176d4174c88ce65d60a8.js" async=""></script><script src="/_next/static/chunks/pages/front/%5Bid%5D-d60ad66e03ab4249afa4.js" async=""></script><script src="/_next/static/jB9Y7kPKJdexBq0JD9Xuy/_buildManifest.js" async=""></script><script src="/_next/static/jB9Y7kPKJdexBq0JD9Xuy/_ssgManifest.js" async=""></script></body></html>