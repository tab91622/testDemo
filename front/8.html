<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><link rel="stylesheet" href="/iconfont/iconfont.css"/><link rel="stylesheet" href="/css/valine.css"/><script src="//unpkg.com/valine/dist/Valine.min.js"></script><title>文章详情</title><meta name="next-head-count" content="6"/><link rel="preload" href="/_next/static/css/15b92494358f552df174.css" as="style"/><link rel="stylesheet" href="/_next/static/css/15b92494358f552df174.css"/><link rel="preload" href="/_next/static/css/052ae0a44094706a10c2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/052ae0a44094706a10c2.css"/><link rel="preload" href="/_next/static/css/f0082a2b33ba635f4dd9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f0082a2b33ba635f4dd9.css"/><link rel="preload" href="/_next/static/chunks/main-d5ecf0b3951669ce080c.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1b5fae6dde8a26be77ac.js" as="script"/><link rel="preload" href="/_next/static/chunks/346fcacd.acdc88755e55ded238c8.js" as="script"/><link rel="preload" href="/_next/static/chunks/5b942159a78d3c3cc608ccd4b77e51e0983cab29.ed4d58faabcf26e54f52.js" as="script"/><link rel="preload" href="/_next/static/chunks/08b74a7a597619e1b87151c58acc0528a78ab6f6.c061d003d0886c32baa8.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-176d4174c88ce65d60a8.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/front/%5Bid%5D-d60ad66e03ab4249afa4.js" as="script"/></head><body><div id="__next"><div class="Header_nav__p_kME"><a class="Header_item__3KWCo" href="/">博客首页</a><a class="Header_item__3KWCo" href="/front">文章列表</a><a class="Header_item__3KWCo" href="/front/logs">更新日志</a><a class="Header_item__3KWCo" href="/front/about">关于</a></div><div class="main"><div class="FrontRoute_container__zQhnm"><div class="FrontRoute_markdown__3G6E8"><h2>node 生命周期</h2><p>循环外两个队列:
nextTick --&gt; promise</p><p>循环内有六个队列:
<strong>timer</strong> --&gt; ... --&gt; ... --&gt; <strong>poll</strong> --&gt; <strong>check</strong> --&gt; ...</p><h3>timer</h3><p>node 也有专门计时的线程,会不断查看 setTimeout setInterval 中的回调任务是否应该进入队列</p><ul><li>该例子说明,由于其他队列的阻塞和干扰,<strong>定时器的实际回调时间,可能会远远大于设置的回调时间</strong></li></ul><pre><code class="language-js">const fs = require(&#x27;fs&#x27;)

const start = Date.now()
setTimeout(() =&gt; {
  console.log(&#x27;setTimeout: &#x27;, Date.now() - start) // 512
}, 200)

fs.readFile(&#x27;./1.txt&#x27;, &#x27;utf-8&#x27;, (err, data) =&gt; {
  if (!err) {
    console.log(&#x27;data: &#x27;, data);
    const start = Date.now()
    while (Date.now() - start &lt; 500) { }
  }
})</code></pre><h3>poll</h3><p>轮询
注意: 不是把读取文件这个行为添加到这个队列中(行为时操作系统做的),<strong>只是把读取文件结束 或者用户请求的回调函数添加到该队列中</strong></p><p><strong>自己有任务时,先清空自己的,然后等待,循环停留</strong></p><p>等待其他队列中添加任务,然后恢复循环</p><p>等待很长的时间后,结束时间循环,应用关闭</p><h3>check</h3><p>setImmediate 中的任务会被直接扔入该队列</p><ul><li>输出的结果不固定<ul><li>主要是因为系统执行的不确定因素,很可能会因为一些事耽搁进入循环,那么 timer 队列就会直接打印</li><li>如果没有事情耽搁,查看 timer 队列的时候,里面还没有任务,会往后查看</li></ul></li></ul><pre><code class="language-js">setTimeout(()=&gt;{
  console.log(&#x27;setTimeout&#x27;)
},1)

setImmediate(()=&gt;{
  console.log(&#x27;setImmediate&#x27;)
})</code></pre></div><hr/><div><div class="FrontRoute_aside__3gFP5"><div class="FrontRouteAside_container__1pfKw"><a class="FrontRouteAside_link__4IF8A FrontRouteAside_left__1-G8B" href="/front/7">上一篇：深入了解 setState</a><a class="FrontRouteAside_link__4IF8A FrontRouteAside_right__286L6" href="/front/9">下一篇：TypeScript 装饰器</a></div></div><div class="FrontRoute_comments__2cMR7"><div><h2>发表评论</h2><div class="Comment_wrapper__184xV8"></div><h2 id="/front/8" class="leancloud_visitors" data-flag-title="node 生命周期"><i class="iconfont icon-liulan"></i>  <i class="leancloud-visitors-count"></i></h2></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"8","title":"node 生命周期","prev":{"id":7,"title":"深入了解 setState"},"next":{"id":9,"title":"TypeScript 装饰器"},"md":{"data":"## node 生命周期\r\n循环外两个队列:\r\nnextTick --\u003e promise\r\n\r\n循环内有六个队列:\r\n**timer** --\u003e ... --\u003e ... --\u003e **poll** --\u003e **check** --\u003e ...\r\n\r\n### timer\r\nnode 也有专门计时的线程,会不断查看 setTimeout setInterval 中的回调任务是否应该进入队列\r\n\r\n* 该例子说明,由于其他队列的阻塞和干扰,**定时器的实际回调时间,可能会远远大于设置的回调时间**\r\n\r\n```js\r\nconst fs = require('fs')\r\n\r\nconst start = Date.now()\r\nsetTimeout(() =\u003e {\r\n  console.log('setTimeout: ', Date.now() - start) // 512\r\n}, 200)\r\n\r\nfs.readFile('./1.txt', 'utf-8', (err, data) =\u003e {\r\n  if (!err) {\r\n    console.log('data: ', data);\r\n    const start = Date.now()\r\n    while (Date.now() - start \u003c 500) { }\r\n  }\r\n})\r\n```\r\n\r\n### poll\r\n轮询\r\n注意: 不是把读取文件这个行为添加到这个队列中(行为时操作系统做的),**只是把读取文件结束 或者用户请求的回调函数添加到该队列中**\r\n\r\n**自己有任务时,先清空自己的,然后等待,循环停留**\r\n\r\n等待其他队列中添加任务,然后恢复循环\r\n\r\n等待很长的时间后,结束时间循环,应用关闭\r\n\r\n### check\r\nsetImmediate 中的任务会被直接扔入该队列\r\n\r\n* 输出的结果不固定\r\n    * 主要是因为系统执行的不确定因素,很可能会因为一些事耽搁进入循环,那么 timer 队列就会直接打印\r\n    * 如果没有事情耽搁,查看 timer 队列的时候,里面还没有任务,会往后查看\r\n```js\r\nsetTimeout(()=\u003e{\r\n  console.log('setTimeout')\r\n},1)\r\n\r\nsetImmediate(()=\u003e{\r\n  console.log('setImmediate')\r\n})\r\n```"}},"__N_SSG":true},"page":"/front/[id]","query":{"id":"8"},"buildId":"jB9Y7kPKJdexBq0JD9Xuy","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-c0664c850fd807bc92c2.js"></script><script src="/_next/static/chunks/main-d5ecf0b3951669ce080c.js" async=""></script><script src="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" async=""></script><script src="/_next/static/chunks/framework.1b5fae6dde8a26be77ac.js" async=""></script><script src="/_next/static/chunks/346fcacd.acdc88755e55ded238c8.js" async=""></script><script src="/_next/static/chunks/5b942159a78d3c3cc608ccd4b77e51e0983cab29.ed4d58faabcf26e54f52.js" async=""></script><script src="/_next/static/chunks/08b74a7a597619e1b87151c58acc0528a78ab6f6.c061d003d0886c32baa8.js" async=""></script><script src="/_next/static/chunks/pages/_app-176d4174c88ce65d60a8.js" async=""></script><script src="/_next/static/chunks/pages/front/%5Bid%5D-d60ad66e03ab4249afa4.js" async=""></script><script src="/_next/static/jB9Y7kPKJdexBq0JD9Xuy/_buildManifest.js" async=""></script><script src="/_next/static/jB9Y7kPKJdexBq0JD9Xuy/_ssgManifest.js" async=""></script></body></html>