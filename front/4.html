<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><link rel="stylesheet" href="/iconfont/iconfont.css"/><link rel="stylesheet" href="/css/valine.css"/><script src="//unpkg.com/valine/dist/Valine.min.js"></script><title>文章详情</title><meta name="next-head-count" content="6"/><link rel="preload" href="/_next/static/css/15b92494358f552df174.css" as="style"/><link rel="stylesheet" href="/_next/static/css/15b92494358f552df174.css"/><link rel="preload" href="/_next/static/css/052ae0a44094706a10c2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/052ae0a44094706a10c2.css"/><link rel="preload" href="/_next/static/css/f0082a2b33ba635f4dd9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f0082a2b33ba635f4dd9.css"/><link rel="preload" href="/_next/static/chunks/main-d5ecf0b3951669ce080c.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1b5fae6dde8a26be77ac.js" as="script"/><link rel="preload" href="/_next/static/chunks/346fcacd.acdc88755e55ded238c8.js" as="script"/><link rel="preload" href="/_next/static/chunks/5b942159a78d3c3cc608ccd4b77e51e0983cab29.ed4d58faabcf26e54f52.js" as="script"/><link rel="preload" href="/_next/static/chunks/08b74a7a597619e1b87151c58acc0528a78ab6f6.c061d003d0886c32baa8.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-176d4174c88ce65d60a8.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/front/%5Bid%5D-d60ad66e03ab4249afa4.js" as="script"/></head><body><div id="__next"><div class="Header_nav__p_kME"><a class="Header_item__3KWCo" href="/">博客首页</a><a class="Header_item__3KWCo" href="/front">文章列表</a><a class="Header_item__3KWCo" href="/front/logs">更新日志</a><a class="Header_item__3KWCo" href="/front/about">关于</a></div><div class="main"><div class="FrontRoute_container__zQhnm"><div class="FrontRoute_markdown__3G6E8"><h1>服务端渲染组件</h1><p>使用<code>renderToString</code>方法将一个React组件元素转换成字符串,然后内嵌到返回的<code>html</code>字符串中</p><pre><code class="language-js">import { renderToString } from &#x27;react-dom/server&#x27;

// ...
const content = renderToString(&lt;App /&gt;);</code></pre><h2>本节课内容</h2><ol><li>服务器书写<code>react</code>组件</li><li>使用<code>webpack</code>打包<strong>服务器代码</strong>到<code>dist</code>目录</li><li>利用<code>@babel/preset-react</code>解析<code>react</code>代码</li><li>利用<code>externals</code>配置和<code>webpack-node-externals</code>排除掉<code>node_modules</code>目录</li><li>重新配置<code>package.json</code></li><li>渲染页面组件的内容到<code>div</code>中</li></ol><h1>客户端渲染组件</h1><p><strong>同构</strong>：保持服务器和客户端渲染一致</p><p>书写客户端启动文件
使用webpack打包客户端代码到public目录
在服务器输出的html代码中引入js
重新配置package.json</p><p>必须保证客户端和服务端的<strong>元素结构 样式名称</strong>完全一致,否则将渲染失败</p><p>服务端和客户端的webpack的打包配置也不一样</p><ul><li><p>服务端:</p><ul><li>服务端不需要打包样式文件,但是需要保证与打包后的客户端的样式名称一致</li><li>使用<code>isomorphic-style-loader</code>转化<code>css-loader</code>处理后的代码,<strong>仅需要哈希</strong></li><li><strong>服务端可以直接依赖<code>node_modules</code>下的第三方库,因此,为了提高打包构建速度,加上<code>externals: [nodeExternals()]</code>配置</strong></li></ul></li><li><p>客户端:</p><ul><li><strong>需要依赖<code>node_modules</code></strong>,因此,webpack配置中要去掉<code>externals</code></li><li>需要与服务端完全一致的元素结合 样式名称</li><li>将所有的文件打包成一个<code>js</code>文件,内嵌到服务端返回的页面资源中</li></ul></li></ul><pre><code class="language-js">import fs from &#x27;fs&#x27;

export default function () {
  const files = fs.readdirSync(&#x27;./public/js&#x27;)
    .filter(file =&gt; file.endsWith(&#x27;.js&#x27;))
    .map(file =&gt; `&lt;script src=&quot;./js/${file}&quot;&gt;&lt;/script&gt;`)

  return files.join(&#x27;\n&#x27;)
}</code></pre></div><hr/><div><div class="FrontRoute_aside__3gFP5"><div class="FrontRouteAside_container__1pfKw"><a class="FrontRouteAside_link__4IF8A FrontRouteAside_left__1-G8B" href="/front/3">上一篇：CSR VS SSR</a><a class="FrontRouteAside_link__4IF8A FrontRouteAside_right__286L6" href="/front/5">下一篇：路由</a></div></div><div class="FrontRoute_comments__2cMR7"><div><h2>发表评论</h2><div class="Comment_wrapper__184xV4"></div><h2 id="/front/4" class="leancloud_visitors" data-flag-title="服务端渲染组件 &amp; 客户端渲染组件"><i class="iconfont icon-liulan"></i>  <i class="leancloud-visitors-count"></i></h2></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"4","title":"服务端渲染组件 \u0026 客户端渲染组件","prev":{"id":3,"title":"CSR VS SSR"},"next":{"id":5,"title":"路由"},"md":{"data":"# 服务端渲染组件\r\n\r\n使用```renderToString```方法将一个React组件元素转换成字符串,然后内嵌到返回的```html```字符串中\r\n\r\n```js\r\nimport { renderToString } from 'react-dom/server'\r\n\r\n// ...\r\nconst content = renderToString(\u003cApp /\u003e);\r\n```\r\n\r\n## 本节课内容\r\n\r\n1. 服务器书写`react`组件\r\n2. 使用`webpack`打包**服务器代码**到`dist`目录\r\n3. 利用`@babel/preset-react`解析`react`代码\r\n4. 利用`externals`配置和`webpack-node-externals`排除掉`node_modules`目录\r\n5. 重新配置`package.json`\r\n6. 渲染页面组件的内容到`div`中\r\n\r\n\r\n# 客户端渲染组件\r\n\r\n**同构**：保持服务器和客户端渲染一致\r\n\r\n书写客户端启动文件\r\n使用webpack打包客户端代码到public目录\r\n在服务器输出的html代码中引入js\r\n重新配置package.json\r\n\r\n\r\n必须保证客户端和服务端的**元素结构 样式名称**完全一致,否则将渲染失败\r\n\r\n服务端和客户端的webpack的打包配置也不一样\r\n* 服务端:\r\n    - 服务端不需要打包样式文件,但是需要保证与打包后的客户端的样式名称一致\r\n    - 使用```isomorphic-style-loader```转化```css-loader```处理后的代码,**仅需要哈希**\r\n    - **服务端可以直接依赖```node_modules```下的第三方库,因此,为了提高打包构建速度,加上```externals: [nodeExternals()]```配置**\r\n\r\n* 客户端:\r\n    - **需要依赖```node_modules```**,因此,webpack配置中要去掉```externals```\r\n    - 需要与服务端完全一致的元素结合 样式名称\r\n    - 将所有的文件打包成一个```js```文件,内嵌到服务端返回的页面资源中\r\n\r\n```js\r\nimport fs from 'fs'\r\n\r\nexport default function () {\r\n  const files = fs.readdirSync('./public/js')\r\n    .filter(file =\u003e file.endsWith('.js'))\r\n    .map(file =\u003e `\u003cscript src=\"./js/${file}\"\u003e\u003c/script\u003e`)\r\n\r\n  return files.join('\\n')\r\n}\r\n```"}},"__N_SSG":true},"page":"/front/[id]","query":{"id":"4"},"buildId":"jB9Y7kPKJdexBq0JD9Xuy","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-c0664c850fd807bc92c2.js"></script><script src="/_next/static/chunks/main-d5ecf0b3951669ce080c.js" async=""></script><script src="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" async=""></script><script src="/_next/static/chunks/framework.1b5fae6dde8a26be77ac.js" async=""></script><script src="/_next/static/chunks/346fcacd.acdc88755e55ded238c8.js" async=""></script><script src="/_next/static/chunks/5b942159a78d3c3cc608ccd4b77e51e0983cab29.ed4d58faabcf26e54f52.js" async=""></script><script src="/_next/static/chunks/08b74a7a597619e1b87151c58acc0528a78ab6f6.c061d003d0886c32baa8.js" async=""></script><script src="/_next/static/chunks/pages/_app-176d4174c88ce65d60a8.js" async=""></script><script src="/_next/static/chunks/pages/front/%5Bid%5D-d60ad66e03ab4249afa4.js" async=""></script><script src="/_next/static/jB9Y7kPKJdexBq0JD9Xuy/_buildManifest.js" async=""></script><script src="/_next/static/jB9Y7kPKJdexBq0JD9Xuy/_ssgManifest.js" async=""></script></body></html>